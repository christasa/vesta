apiVersion: v1
kind: Pod
metadata:
  name: vulntest
  labels:
    app: vulntest
spec:
  automountServiceAccountToken: false
  containers:
    - name: vulntest
      image: nginx
      volumeMounts:
      - name: test-volume
        mountPath: /opt/vulntest
      ports:
        - containerPort: 80
      securityContext:
        privileged: true
        allowPrivilegeEscalation: true
      resources:
        limits:
          cpu: "1"
    - name: sidecartest
      image: mysql:5.6
      ports:
      - containerPort: 3306
      imagePullPolicy: IfNotPresent
      env:
      - name: MYSQL_ROOT_PASSWORD
        value: password
      - name: NO_PASSWORD
        valueFrom:
          resourceFieldRef:
            containerName: test-volume
            resource: requests.cpu
  volumes:
    - name: test-volume
      hostPath:
        path: /etc/
        type: Directory

---
apiVersion: v1
kind: Pod
metadata:
  name: vulntest2
  labels:
    app: vulntest2
spec:
  containers:
    - name: vulntest2
      image: nginx
      volumeMounts:
      ports:
        - containerPort: 80
      securityContext:
        capabilities:
          add: ["CAP_SYS_ADMIN"]
      resources:
        limits:
          memory: "512Mi"